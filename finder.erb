<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
          "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <link rel="stylesheet" href="../style.css" type="text/css" />
  <title>MuninFinder</title>
  <meta http-equiv="content-type" content="application/xhtml+xml; charset=iso-8859-1" />
  <meta name="author" content="Auto-generated by Munin" />
  <link rel="icon" type="image/vnd.microsoft.icon" href="../favicon.ico" />
  <link rel="SHORTCUT ICON" href="../favicon.ico"/>
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

<style type="text/css">
#wrap{
  width: 1250px;
}
#logo{
  margin: 15px 0;
}
#menu {
  float: left;
  width: 200px;
  padding-left: 15px;
  margin-top: 18px;
  overflow: hidden;
  border: solid 2px #d0d0d0;
  background-color: #f0f0f0;
}
#menu > div{
  width: 1000px;
  position: relative;
}
#menu input{
  position: absolute;
}
#menu input.update{
  left: 160px;
  border: 2px solid #688AAF;
  padding: 2px 6px;
  color: #fff;
  cursor: pointer;
  background: #486AAF;
  border-radius: 5px;
}
#menu label{
  padding: 2px;
  display: block;
  margin-left: 20px;
}
#graph {
  float: left;
  width: 1000px;
}
#graph > div{
  width: 495px;
  padding-left: 5px;
  padding-bottom: 5px;
  float: left;
}

</style>
</head>
<body>
<div id="wrap">
<div id="logo">
<a href="../index.html"><img src="../logo-h.png" /></a>
</div>

<form action="" method="get" name="form" onsubmit="return update_graph()">
<div id="menu">
<h3><a href="#" onclick="return toggle_all('host')">Host</a>
<input class="update" type="submit" name="update" value="update" />
</h3>
<%menu[:host].each do |val|%>
<%title = File.basename(val)%>
<div><input type="checkbox" id="host_<%=title%>" name="host" title="<%=title%>" value="<%=val%>" /><label for="host_<%=title%>"><%=title%></label></div>
<%end%>

<h3><a href="#" onclick="return toggle_all('graph')">Graph</a>
<input class="update" type="submit" name="update" value="update" />
</h3>
<%menu[:graph].each do |val|%>
<div><input type="checkbox" id="graph_<%=val%>" name="graph" title="<%=val%>" value="<%=val%>" /><label for="graph_<%=val%>"><%=val%></label></div>
<%end%>
</div>
</form>
<div id="graph">
<%list.each_with_index do |png, idx|%>
<%next unless png =~ /\/(load2|load_extended)-/%>
<div>
<a href="<%=png.sub(/-.+\.png$/, '.html')%>"><%=File.basename(File.dirname(png))%> :: <%=File.basename(png).split("-").first%></a>
<a href="<%=png.sub(/-.+\.png$/, '.html')%>"><img src="<%=png%>" /></a>
</div>
<%end%>
</div>
<br style="clear: both;"/>
</div>
<script type="text/javascript">
  var list = <%=list.inspect%>;
  function update_graph(){
    var hosts = $("input[name='host']:checked");
    var graphs = $("input[name='graph']:checked");
    if(hosts.size() == 0 || graphs.size() == 0){
      alert("please check");
      return false;
    }

    location.hash = $.param({
      graph: graphs.map(function(){return $(this).attr("title")}).toArray().join(","),
      host: hosts.map(function(){return $(this).attr("title")}).toArray().join(",")});

    $("#graph").empty();
    hosts.each(function(){
      var host = $(this);
      graphs.each(function(){
        var graph = $(this);
        var src = host.val()+"/"+graph.val()+"-day.png";
        if($.inArray(src, list) >= 0){
          var div = '<div><a href="'+host.val()+"/"+graph.val()+".html"+'">'+host.attr("title")+' :: '+graph.val()+'</a><a href="'+host.val()+"/"+graph.val()+".html"+'"><img src="'+src+'" /></a></div>';
          $("#graph").append(div);
          src = host.val()+"/"+graph.val()+"-week.png";
          div = '<div><a href="'+host.val()+"/"+graph.val()+".html"+'">'+host.attr("title")+' :: '+graph.val()+'</a><a href="'+host.val()+"/"+graph.val()+".html"+'"><img src="'+src+'" /></a></div>';
          $("#graph").append(div);
        }
      });
    });
    return false;
  }
  function toggle_all(arg){
    var val = $("input[name="+arg+"]:first").is(":checked");
    $("input[name="+arg+"]").attr("checked",!val);
    return false;
  }
  function restore_all(){
    var restore = location.hash.replace(/^#/,'');
    if(restore.length > 0){
      $.each(restore.split("&"), function(i, param){
        var key_val = param.split("=");
        var key = key_val[0];
        $.each(key_val[1].split(","), function(j, val){
          $("input[name='"+key+"'][title='"+val+"']").attr("checked",true);
        });
      });
    }
  }
  $(function(){restore_all()})
</script>
</body>
</html>
